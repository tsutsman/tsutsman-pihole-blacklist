# Аналітичний звіт про стан проєкту

[English version](en/project-analysis.md)

## 1. Місія та контекст
- Репозиторій забезпечує централізоване зберігання списків доменів і регулярних виразів для Pi-hole, спрямованих на блокування інфраструктури держав-агресорів.
- Основна цінність — синергія вручну підтримуваних даних (`domains.txt`, `regex.list`) з автоматизованим збором нових доменів та розвиненою системою метаданих у `data/`.

## 2. Архітектура репозиторію
### 2.1. Джерела даних
- Файли `domains.txt` та `regex.list` є базовими артефактами, що використовуються Pi-hole напряму.
- Директорія `data/` містить конфігураційні JSON-файли: `catalog.json` для метаданих, `sources.json` для опису джерел, `domain_status.json` для історії появи доменів і `false_positives.json` для ручних винятків.
- Директорія `reports/` агрегує результати запусків (наприклад, `latest_update.json`) і забезпечує прозорість змін.

### 2.2. Скрипти та бізнес-логіка
- `scripts/check_lists.py` виконує комплексну валідацію: перевіряє синтаксис, дублікати, перетини між списками, наявність метаданих та за потреби DNS-доступність доменів.
- `scripts/update_domains.py` відповідає за агрегацію зовнішніх джерел, керування вагами та генерацію звіту про нові записи.
- `scripts/generate_lists.py` будує дистрибутиви у форматах AdGuard, uBlock, hosts тощо, підтримуючи сегментацію за категоріями, регіонами й джерелами.
- `scripts/audit_lists.py` та `scripts/validate_catalog.py` проводять аудит покриття і контроль відповідності політикам включення.
- Допоміжні класи та функції (`scripts/utils.py`) забезпечують уніфіковане завантаження записів і роботу з метаданими, включно з фільтрами та тегами.

### 2.3. Тестова інфраструктура
- Покриття організовано через `pytest`; каталог `tests/` містить окремі модулі для кожного скрипта та загальних утиліт.
- Наявний `tests/test_update_domains.py` імітує конфігурації джерел, `tests/test_generate_lists.py` перевіряє формування сегментів, а `tests/test_check_lists.py` — сценарії валідації.

### 2.4. Документація та стандарти
- `README.md` містить детальний опис використання, інструментів автоматизації та переліку джерел.
- Документація в `docs/` охоплює критерії включення (`criteria.md`), аудит (`audit.md`) та каталог ключових доменів.
- Наявна базова дорожня карта (`docs/roadmap.md`), яку рекомендовано узгодити з оновленим планом нижче.

### 2.5. Автоматизація та CI/CD
- Конвеєр GitHub Actions (`.github/workflows/ci.yml`) запускає перевірку списків, модульні тести та генерацію дистрибутивів на Python 3.11 під час кожного pull request і щотижня за розкладом.
- Налаштовано використання `pre-commit` для локальних перевірок якості коду перед комітами.

## 3. Якість даних і процесів
- Метадані охоплюють категорії, регіони, джерела, рівні критичності та прапор моніторингу, що дає змогу будувати таргетовані сегменти.
- Існує механізм обліку хибнопозитивів через `data/false_positives.json`, але не передбачено автоматизованого фідбек-циклу від користувачів.
- Оновлення зовнішніх джерел залежать від конфігурації `data/sources.json`; критично забезпечити регулярний перегляд достовірності та ваг.
- Звітність (`reports/latest_update.json`) фіксує останні зміни, однак бракує історичного трекінгу та метрик ефективності блокувань.

## 4. Тестування та стабільність
- Повний набір модульних тестів (`35` тестів) успішно проходить на Python 3.12 у локальному середовищі, що підтверджує сумісність з новою версією інтерпретатора.
- У репозиторії відсутні інтеграційні тести для взаємодії з реальними DNS-службами або перевірки результуючих списків на тестовому Pi-hole.
- Не зафіксовано вимірювання покриття коду; необхідно впровадити збір метрик (наприклад, `coverage.py`) і поріг не нижче 80% згідно з внутрішніми вимогами.

## 5. Ризики та вузькі місця
- Ручне підтримання метаданих може призводити до розсинхронізації між списками і каталогом, якщо відсутній обов'язковий конвеєр перевірок перед релізом.
- Відсутність централізованої бази інцидентів із хибними спрацюваннями ускладнює їх аналіз і пріоритезацію виправлень.
- Поточний CI-пайплайн не виконує статичний аналіз безпеки залежностей і не зберігає артефакти згенерованих списків для подальшої валідації.
- Немає регламенту щодо версіонування релізів і автоматичного оголошення змін (Changelog оновлюється вручну).

## 6. Можливості розвитку
- Розширення каталогізації (додаткові теги, рівні довіри) дозволить точніше формувати сегментовані дистрибутиви для різних сценаріїв використання.
- Інтеграція телеметрії або зворотного зв'язку від користувачів Pi-hole підвищить точність виявлення хибнопозитивів.
- Автоматичне зіставлення зі сторонніми threat-intel базами (VirusTotal, AbuseIPDB) може покращити пріоритезацію нових доменів.
- Використання контейнеризованого середовища для тестового розгортання Pi-hole дозволить валідувати релізи «під ключ».

## 7. Рекомендований дорожній план (високорівневий)
- Короткостроково: стандартизувати перевірки якості даних, розширити тестовий покриття та формалізувати процедуру релізів.
- Середньостроково: автоматизувати збір телеметрії, збудувати дашборди аналітики та запустити конвеєр оцінки достовірності джерел.
- Довгостроково: інтегрувати машинне навчання/евристики для прогнозування загроз, впровадити відмовостійку інфраструктуру доставки списків і публічні API.

Докладний план впровадження наведений у файлі `docs/roadmap.md`.
